<!DOCTYPE html><html class="appearance-dark" lang="en"><head><meta charset="UTF-8"><title>Tấn công chuyển hướng website cờ bạc, cá độ</title><meta name="description" content="Zhong De mũm mĩm"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/bin.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="1. Thông tin ban đầuNăm 2022 - 2023, các website Cổng thông tin điện tử tại Việt Nam hầu hết bị tấn công bởi mã độc khiến chuyển hướng đến các website cờ bạc.Thông qua tìm kiếm trên google, các kết quả trả về sẽ chuyển hướng 404 rồi sang website cá độ, cờ bạc.
Search Engine Optimization (SEO) - Tối ưu hóa công cụ tìm kiếm là quá trình tăng chất lượng và lư.."><meta name="generator" content="Hexo 7.0.0"></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Bai Zhong De's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Tấn công chuyển hướng website cờ bạc, cá độ</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Thong-tin-ban-dau"><span class="toc-text">1. Thông tin ban đầu</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Mot-loai-ma-doc-tren-he-thong"><span class="toc-text">2. Một loại mã độc trên hệ thống</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Persistence-Mechanism"><span class="toc-text">2.1. Persistence Mechanism</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Ma-doc-duoc-goi-qua-config-file"><span class="toc-text">2.2. Mã độc được gọi qua config file</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Khac-phuc"><span class="toc-text">3. Khắc phục</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-Nguyen-nhan-tan-cong"><span class="toc-text">3.1. Nguyên nhân tấn công</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-Xoa-cache-google"><span class="toc-text">3.2. Xóa cache google</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-IoCs"><span class="toc-text">4. IoCs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shout-out"><span class="toc-text">Shout-out</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/windows"><i class="tag post-item-tag">windows</i></a><a href="/tags/IIS"><i class="tag post-item-tag">IIS</i></a><a href="/tags/IISerpent"><i class="tag post-item-tag">IISerpent</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">Tấn công chuyển hướng website cờ bạc, cá độ</h1><time class="has-text-grey" datetime="2023-10-21T06:31:31.000Z">2023-10-21</time><article class="mt-2 post-content"><h2 id="1-Thong-tin-ban-dau"><a href="#1-Thong-tin-ban-dau" class="headerlink" title="1. Thông tin ban đầu"></a>1. Thông tin ban đầu</h2><p>Năm 2022 - 2023, các website Cổng thông tin điện tử tại Việt Nam hầu hết bị tấn công bởi mã độc khiến chuyển hướng đến các website cờ bạc.<br><img src="/../images/Tan-cong-chuyen-huong-website-IIS/check1.PNG"><br>Thông qua tìm kiếm trên google, các kết quả trả về sẽ chuyển hướng 404 rồi sang website cá độ, cờ bạc.</p>
<p>Search Engine Optimization (SEO) - Tối ưu hóa công cụ tìm kiếm là quá trình tăng chất lượng và lưu<br>lượng truy cập website bằng cách tăng khả năng hiển thị của website hoặc webpage cho người dùng<br>trên các máy truy tìm dữ liệu như Google</p>
<p>Tìm kiếm trên công cụ google với các từ khóa liên quan đến cá độ, cờ bạc, với tùy chọn là trang tên miền chứa gov.vn, edu.vn người dùng có thể dễ dàng nhìn thấy nhiều trang có đuôi tên miền *.gov.vn của các cơ quan nhà nước đã bị tấn công “hack” và chèn các đường link quảng cáo, dòng mã độc IISerpent.<br>    IISerpent được triển khai và định cấu hình dưới dạng tiện ích mở rộng độc hại cho IIS – phần mềm máy chủ web của Microsoft. Điều đó cho phép phần mềm độc hại chặn tất cả các yêu cầu HTTP được gửi đến các trang web được lưu trữ bởi máy chủ bị xâm nhập, đồng thời chủ động thay đổi phản hồi HTTP của máy chủ.<br>     Các công cụ tìm kiếm thường xuyên thu thập thông tin trên internet, sau đó lập chỉ mục tất cả nội dung được tìm thấy trực tuyến, xây dựng mối liên hệ giữa cụm từ tìm kiếm và nội dung, đồng thời sử dụng nhiều thuật toán khác nhau để tính toán thứ hạng của kết quả cho các cụm từ tìm kiếm cụ thể.<br>    Khi truy cập vào website như bình thường, nó sẽ lập tức chuyển hướng sang bên thứ 3, các nội dung website này bao gồm cờ bạc, khiêu dâm, …</p>
<h2 id="2-Mot-loai-ma-doc-tren-he-thong"><a href="#2-Mot-loai-ma-doc-tren-he-thong" class="headerlink" title="2. Một loại mã độc trên hệ thống"></a>2. Một loại mã độc trên hệ thống</h2><p>Ngoài những việc thay đổi <code>config</code> để load một số module trên IIS Server, dưới đây là một số cách loại mã độc này thực hiện.</p>
<h3 id="2-1-Persistence-Mechanism"><a href="#2-1-Persistence-Mechanism" class="headerlink" title="2.1. Persistence Mechanism"></a>2.1. Persistence Mechanism</h3><p><img src="/../images/Tan-cong-chuyen-huong-website-IIS/check2.PNG"><br>Mã độc duy trì hoạt động trong Windows Service với tham số là một tệp dll độc hại tại <code>C:\\Windows\System32\wpdbusenum.dll</code>. Tệp wpdbusenum.dll đóng vai trò tạo các tệp SEO dll.</p>
<p>Các tệp độc hại :<br><code>C:\Windows\Logs\CBS\API.log</code><br><code>C:\Windows\Logs\CBS\ART.log</code><br><code>C:\ProgramData\Microsoft\Network\apicgi.dll</code><br><code>C:\ProgramData\Microsoft\Network\apifastcgi.dll</code></p>
<p>Tiến trình <code>cmd</code> fake thực hiện copy nội dung vào <code>apicgi.dll</code></p>
<p>Tiến hành đóng dịch vụ IIS, stop service độc hại đang chạy.</p>
<h3 id="2-2-Ma-doc-duoc-goi-qua-config-file"><a href="#2-2-Ma-doc-duoc-goi-qua-config-file" class="headerlink" title="2.2. Mã độc được gọi qua config file"></a>2.2. Mã độc được gọi qua config file</h3><p>Khi nhận thấy website chuyển hướng đến link cố định, ở đây là <code>baidu.*</code>, file mã độc không obfuscate domain, nên sử dụng rule tìm kiếm để tiết kiệm thời gian.<br>Tiến hành kiểm tra trong thư mục <code>system32</code>.</p>
<p>yara rule</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  	Rule scan &#123;</span><br><span class="line">Strings: </span><br><span class="line">	$a = &quot;baidu&quot;</span><br><span class="line">Condition:</span><br><span class="line">	$a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yara64.exe .\rulescan.txt -r C:\Windows\System32\inetsrv\</span><br></pre></td></tr></table></figure>
<p>Trường hợp thấy <code>.dll</code> được load, tiến hành dừng dịch vụ IIS.<br>Xóa dòng load Dll trong file config :<br><code>C:\Windows\System32\inetsrv\config\applicatitonHost.config</code><br>Xóa file dll <code>C:\Windows\System32\inetsrv</code></p>
<h2 id="3-Khac-phuc"><a href="#3-Khac-phuc" class="headerlink" title="3. Khắc phục"></a>3. Khắc phục</h2><h3 id="3-1-Nguyen-nhan-tan-cong"><a href="#3-1-Nguyen-nhan-tan-cong" class="headerlink" title="3.1. Nguyên nhân tấn công"></a>3.1. Nguyên nhân tấn công</h3><p>Với mỗi hệ thống, lại có một nguyên nhân tấn công khác nhau.<br>Về cơ bản, các hệ thống cổng thông tin điện tử có một số lỗ hổng phổ biến như phiên bản Telerik có lỗ hổng: CVE-2019-18935, CVE-2017-11317<br><img src="/../images/Tan-cong-chuyen-huong-website-IIS/check3.png"><br>Poc cho các lỗ hổng này có sẵn.</p>
<p>Các file upload không kiểm duyệt đuôi file <code>.ashx</code> dẫn đến thực thi webshell.</p>
<p>Và rất nhiều lỗ hổng khác mà mình chưa rõ thông tin.</p>
<h3 id="3-2-Xoa-cache-google"><a href="#3-2-Xoa-cache-google" class="headerlink" title="3.2. Xóa cache google"></a>3.2. Xóa cache google</h3><p>Vì khi tìm kiếm Google sẽ hiện lên các website cờ bạc, cá độ, cần report cho Google gỡ các kết quả tìm kiếm này.<br>Thực hiện xóa cache Google theo hưởng dẫn được mô tả chi tiết:<br>Bước 1: Truy cập  Google Search Console và đăng nhấp<br>Bước 2: Chọn nhập tiền tố URL và nhấn tiếp tục<br>Bước 3: Thực hiện xác minh chủ sỡ hữu domain<br>Bước 4: Nhấn xóa sản phẩm<br>Hướng dẫn chi tiết trong hai bài viết sau.<br><a target="_blank" rel="noopener" href="https://passwordprotectwp.com/remove-private-content-google-cache/#:~:text=Remove%20your%20Cached%20Pages%20with%20Google%20Search%20Console&text=In%20the%20%E2%80%9CIndex%E2%80%9D%20menu%2C,option%20and%20submit%20your%20request">Remove private content Google cache</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=h223mCgbmf4">Remove in Search console</a></p>
<h2 id="4-IoCs"><a href="#4-IoCs" class="headerlink" title="4. IoCs"></a>4. IoCs</h2><p>SHA256<br><code>apicgi.dll</code>: 08f965f640a3ec1c3aa9c31033455fad02550485d0d5b6fe33553d374775f18a</p>
<p><code>apifastcgi.dll</code>: bf45c48b209e5004520b5d541e406c183bccb2fe81f3974c2c53be48017f74ca</p>
<p><code>wpdbusenum.dll</code>: aa9efe49bf7846c5f805f077f0d0bf9f0e1e7758fafd9bcf9984d6fc4c20892a</p>
<h2 id="Shout-out"><a href="#Shout-out" class="headerlink" title="Shout-out"></a>Shout-out</h2><p>Cảm ơn DieuPX.</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2023/11/22/Phishing-tancongnguoidungwindows/" title="Phishing tấn công người dùng Windows"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: Phishing tấn công người dùng Windows</span></a><a class="button is-default" href="/2023/10/05/Tan-cong-nguoi-dung-dich-vu-Facebook-Ads/" title="Tấn công người dùng làm dịch vụ Facebook Ads"><span class="has-text-weight-semibold">Next: Tấn công người dùng làm dịch vụ Facebook Ads</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="baizhongde/baizhongde.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/baizhongde"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><a title="linkedin" target="_blank" rel="noopener nofollow" href="//www.linkedin.com/in/ducbt97"><i class="iconfont icon-linkedin"></i></a><!-- 脸书--></section><p><span>Copyright ©</span><span> Bai Zhong De 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="" href="">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"></div><!--  a(title="github-button" class="github-button" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true") --></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>